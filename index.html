<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D-Star Net Listings</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">
    <script>
        // Function to update the clock every second
        function updateClock() {
            const now = new Date();
            const utcHours = now.getUTCHours();
            const utcMinutes = now.getUTCMinutes();
            const utcSeconds = now.getUTCSeconds();
            // Format the time as HH:MM:SS UTC
            const formattedTime = `${utcHours.toString().padStart(2, '0')}:${utcMinutes.toString().padStart(2, '0')}:${utcSeconds.toString().padStart(2, '0')} UTC`;
            document.getElementById("utcClock").textContent = formattedTime;
        }
        // Call updateClock every 1000ms (1 second)
        setInterval(updateClock, 1000);

        // Function to load JSON data from the provided URL
        function loadJSONData() {
            console.log("Loading JSON data from file");
            const jsonUrl = 'https://raw.githubusercontent.com/sonyccd/d-star-net-list/refs/heads/main/d-star-net-schedule.json'; // Adjust the URL as needed
            fetch(jsonUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return response.json();
                })
                .then(data => {
                    console.log("JSON data loaded successfully.", data);
                    populateTable(data);
                })
                .catch(error => {
                    console.error("Failed to load JSON data:", error);
                    alert("Failed to load JSON data. Error: " + error.message + "\nPlease check the console for more details.");
                });
        }

        // Function to populate the HTML table with the parsed JSON data
        function populateTable(data) {
            console.log("Populating table with data.", data);
            const tableBody = document.getElementById("netTableBody");
            tableBody.innerHTML = ""; // Clear any existing rows
            // Iterate over each row of data and create table rows dynamically
            try {
                data.forEach((row, index) => {
                    // Skip rows with missing critical fields (e.g., Net name or UTC)
                    if (!row["Net name"] || !row["UTC"]) {
                        console.warn(`Skipping row ${index + 1} due to missing critical fields.`, row);
                        return;
                    }
                    console.log(`Processing row ${index + 1}:`, row);
                    const tableRow = document.createElement("tr");
                    tableRow.innerHTML = `
                        <td>${row["Net name"] || ''}</td>
                        <td class='text-center'>${row["Mo"] === 'x' ? '<i class="bi bi-check-lg"></i>' : ''}</td>
                        <td class='text-center'>${row["Tu"] === 'x' ? '<i class="bi bi-check-lg"></i>' : ''}</td>
                        <td class='text-center'>${row["We"] === 'x' ? '<i class="bi bi-check-lg"></i>' : ''}</td>
                        <td class='text-center'>${row["Th"] === 'x' ? '<i class="bi bi-check-lg"></i>' : ''}</td>
                        <td class='text-center'>${row["Fr"] === 'x' ? '<i class="bi bi-check-lg"></i>' : ''}</td>
                        <td class='text-center'>${row["Sa"] === 'x' ? '<i class="bi bi-check-lg"></i>' : ''}</td>
                        <td class='text-center'>${row["Su"] === 'x' ? '<i class="bi bi-check-lg"></i>' : ''}</td>
                        <td>${row["UTC"] || ''}</td>
                        <td>${row["Mode"] || ''}</td>
                        <td>${row["Node"] || ''}</td>
                        <td>${row["Comment"] || ''}</td>
                    `;
                    tableBody.appendChild(tableRow); // Append the new row to the table body
                });
                console.log("Table populated successfully.");
            } catch (error) {
                console.error("Error populating table:", error);
                alert("An error occurred while populating the table. Error: " + error.message + "\nPlease check the console for more details.");
            }
        }

        // Function to filter the table based on user input
        function filterTable() {
            console.log("Filtering table...");
            const nameInput = document.getElementById("nameFilter").value.toUpperCase(); // Get the filter value for name
            const dayFilter = document.getElementById("dayFilter").value; // Get the selected day to filter by
            const table = document.getElementById("netTable");
            const rows = table.getElementsByTagName("tr");

            // Iterate over all rows, starting from index 1 to skip the header row
            try {
                for (let i = 1; i < rows.length; i++) {
                    const nameCell = rows[i].getElementsByTagName("td")[0]; // Net Name column
                    const nameMatch = nameCell && nameCell.textContent.toUpperCase().includes(nameInput); // Check if name matches filter

                    // Get the day index based on the selected day filter (if any)
                    const dayIndex = {"Monday": 1, "Tuesday": 2, "Wednesday": 3, "Thursday": 4, "Friday": 5, "Saturday": 6, "Sunday": 7}[dayFilter];
                    const dayCell = dayFilter && rows[i].getElementsByTagName("td")[dayIndex]; // Get the cell for the selected day
                    const dayMatch = !dayFilter || (dayCell && dayCell.innerHTML.includes('bi-check-lg')); // Check if day matches filter

                    // Show or hide the row based on the filter matches
                    rows[i].style.display = nameMatch && dayMatch ? "" : "none";
                }
                console.log("Table filtering completed.");
            } catch (error) {
                console.error("Error filtering table:", error);
                alert("An error occurred while filtering the table. Error: " + error.message + "\nPlease check the console for more details.");
            }
        }

        // Load the JSON data when the document content is fully loaded
        document.addEventListener("DOMContentLoaded", loadJSONData);
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.5.0/font/bootstrap-icons.min.css">
</head>
<body onload="updateClock()">
    <div class="container mt-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="mb-0">D-Star Net Listings (UTC)</h1>
            <div class="clock">
                <span id="utcClock" class="fw-bold"></span>
            </div>
        </div>
        <h3 class="mb-4">Built from N5VLZ's great spreadsheet</h3>
        <div class="filter-box row g-3">
            <div class="col-md-6">
                <input type="text" id="nameFilter" onkeyup="filterTable()" class="form-control" placeholder="Filter by name...">
            </div>
            <div class="col-md-6">
                <select id="dayFilter" onchange="filterTable()" class="form-select">
                    <option value="">Filter by day</option>
                    <option value="Monday">Monday</option>
                    <option value="Tuesday">Tuesday</option>
                    <option value="Wednesday">Wednesday</option>
                    <option value="Thursday">Thursday</option>
                    <option value="Friday">Friday</option>
                    <option value="Saturday">Saturday</option>
                    <option value="Sunday">Sunday</option>
                </select>
            </div>
        </div>
        <div class="table-responsive mt-4">
            <table id="netTable" class="table table-bordered table-striped">
                <thead class="table-light">
                    <tr>
                        <th>Net Name</th>
                        <th class='text-center'>Monday</th>
                        <th class='text-center'>Tuesday</th>
                        <th class='text-center'>Wednesday</th>
                        <th class='text-center'>Thursday</th>
                        <th class='text-center'>Friday</th>
                        <th class='text-center'>Saturday</th>
                        <th class='text-center'>Sunday</th>
                        <th>UTC Time</th>
                        <th>Mode</th>
                        <th>Node</th>
                        <th>Comment</th>
                    </tr>
                </thead>
                <tbody id="netTableBody">
                    <!-- Data will be populated here dynamically from JSON -->
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>
